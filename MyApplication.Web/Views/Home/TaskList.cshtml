@model MyApplication.Web.Models.BusinessPageViewModel
@using TaskStatus = MyApplication.Web.Models.TaskStatus;

<div class="list-container">

<!-- Filtre Çubuğu -->
<form method="get" asp-action="TaskList" asp-controller="Home" class="form-inline mb-3">
    <label for="userId" class="mr-2">Kullanıcı:</label>
    <select id="userId" name="userId" class="form-control mr-3" onchange="this.form.submit()">
        <option value="">Tümü</option>
        @if (Model.Users != null)
        {
            foreach (var user in Model.Users)
            {
                var selected = ViewContext.HttpContext.Request.Query["userId"] == user.Id.ToString() ? "selected" : "";
                @Html.Raw($"<option value=\"{user.Id}\" {selected}>{user.UserName}</option>")
            }
        }
    </select>
    <label for="status" class="mr-2">Durum:</label>
    <select id="status" name="status" class="form-control mr-3" onchange="this.form.submit()">
        <option value="">Tümü</option>
        @foreach (TaskStatus status in Enum.GetValues(typeof(TaskStatus)))
        {
            var statusText = status == TaskStatus.ToDo ? "Yapılacak" : status == TaskStatus.InProgress ? "Yapılıyor" : status == TaskStatus.Done ? "Tamamlandı" : status.ToString();
            var selected = ViewContext.HttpContext.Request.Query["status"] == ((int)status).ToString() ? "selected" : "";
            @Html.Raw($"<option value=\"{(int)status}\" {selected}>{statusText}</option>")
        }
    </select>
</form>

<table class="table">
    <thead>
        <tr>
            <th>Task Adı</th>
            <th>Açıklama</th>
            <th>Durum</th>
            <th>Kullanıcı</th>
            <th>Oluşturulma Tarihi</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var task in Model.Tasks)
        {
            <tr class="@GetStatusClass(task.Status)">
                <td>@task.Title</td>
                <td>@task.Description</td>
                <td>@(task.Status == TaskStatus.ToDo ? "Yapılacak" : task.Status == TaskStatus.InProgress ? "Yapılıyor" : task.Status == TaskStatus.Done ? "Tamamlandı" : task.Status.ToString())</td>
                <td>@(task.User?.UserName ?? "Kullanıcı Yok")</td>
                <td>@task.CreatedDate.ToString("yyyy-MM-dd")</td>
            </tr>
        }
    </tbody>
</table>

</div>

@functions {
    string GetStatusClass(TaskStatus status)
    {
        switch (status)
        {
            case TaskStatus.ToDo:
                return "table-warning";  // Bootstrap sınıfı ile sarı
            case TaskStatus.InProgress:
                return "table-primary";  // Bootstrap sınıfı ile mavi
            case TaskStatus.Done:
                return "table-success";  // Bootstrap sınıfı ile yeşil
            default:
                return "";
        }
    }
}
